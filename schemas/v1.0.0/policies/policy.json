{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raxe.ai/schemas/v1.0.0/policies/policy.json",
  "title": "RAXE Policy Definition",
  "type": "object",
  "required": ["policy_id", "customer_id", "name", "conditions", "action"],
  "properties": {
    "policy_id": {
      "type": "string",
      "pattern": "^pol-[a-z0-9]{8}$",
      "description": "Unique policy identifier"
    },
    "customer_id": {
      "type": "string",
      "pattern": "^cust-[a-z0-9]{8}$",
      "description": "Customer who owns this policy"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100
    },
    "description": {
      "type": "string",
      "maxLength": 500
    },
    "conditions": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/condition"
      },
      "description": "List of conditions (OR logic)"
    },
    "action": {
      "type": "string",
      "enum": ["ALLOW", "BLOCK", "FLAG", "LOG"],
      "description": "Action when conditions match"
    },
    "override_severity": {
      "$ref": "#/definitions/severity"
    },
    "priority": {
      "type": "integer",
      "minimum": 0,
      "maximum": 1000,
      "default": 0,
      "description": "Priority for conflict resolution"
    },
    "notify_webhooks": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uri",
        "pattern": "^https?://"
      }
    },
    "enabled": {
      "type": "boolean",
      "default": true
    },
    "metadata": {
      "type": "object",
      "additionalProperties": {"type": "string"}
    }
  },
  "definitions": {
    "condition": {
      "type": "object",
      "properties": {
        "rule_ids": {
          "type": "array",
          "items": {"type": "string"}
        },
        "severity_threshold": {
          "$ref": "#/definitions/severity"
        },
        "threat_types": {
          "type": "array",
          "items": {"type": "string"}
        },
        "min_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "max_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "custom_filter": {
          "type": "string",
          "description": "JSONPath expression for advanced filtering"
        }
      }
    },
    "severity": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low", "info"]
    }
  }
}