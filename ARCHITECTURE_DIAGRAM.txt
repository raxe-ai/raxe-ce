╔════════════════════════════════════════════════════════════════════════════════╗
║                    RAXE CE - COMPLETE ARCHITECTURE                            ║
╚════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────┐
│                         USER INTERFACE LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │   CLI    │  │   SDK    │  │Decorator │  │ Wrappers │  │Plugins   │        │
│  │ (Click)  │  │(Raxe())  │  │(@protect)│  │(OpenAI,  │  │(Custom)  │        │
│  │          │  │          │  │          │  │Anthropic)│  │          │        │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘        │
│       │             │             │             │             │               │
│       └─────────────┴─────────────┴─────────────┴─────────────┘               │
│                             ↓                                                  │
│                    ┌────────────────────┐                                      │
│                    │   SINGLE ENTRY     │                                      │
│                    │   Raxe.scan()      │                                      │
│                    │   ONLY SCAN METHOD │                                      │
│                    └─────────┬──────────┘                                      │
│                              │                                                 │
└──────────────────────────────┼──────────────────────────────────────────────────┘
                               │
┌──────────────────────────────┼──────────────────────────────────────────────────┐
│                 APPLICATION LAYER (Orchestration)                              │
├──────────────────────────────┼──────────────────────────────────────────────────┤
│                              │                                                 │
│      ┌──────────────────────┴─────────────────┐                               │
│      │      ScanPipeline.scan()                │                               │
│      │  (Complete Workflow Orchestration)      │                               │
│      └──────────────────────┬─────────────────┘                               │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 1. PRELOAD (One-time at startup)              │                           │
│  │    └─ Load configs, packs, compile patterns  │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 2. L1 LAYER (Regex-based Detection) <5ms     │                           │
│  │    └─ RuleExecutor.execute()                  │                           │
│  │    └─ PatternMatcher.match()                  │                           │
│  │    └─ Detections[]                            │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 3. L2 LAYER (ML Detection) <1ms               │                           │
│  │    └─ L2Detector.detect()                     │                           │
│  │    └─ Predictions[]                           │                           │
│  │    └─ (Skip if fail_fast_on_critical)         │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 4. PLUGIN LAYER (Custom Detection)            │                           │
│  │    └─ PluginManager.run_detectors()           │                           │
│  │    └─ Detections from plugins                 │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 5. MERGE RESULTS                              │                           │
│  │    └─ ScanMerger.merge()                      │                           │
│  │    └─ CombinedScanResult (highest severity)   │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 6. APPLY POLICY                               │                           │
│  │    └─ ScanPolicy.should_block()               │                           │
│  │    └─ BlockAction (ALLOW/WARN/BLOCK)          │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 7. EXECUTE ACTIONS                            │                           │
│  │    └─ PluginManager.run_actions()             │                           │
│  │    └─ Send Slack, log, webhook, etc.          │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 8. TRACK & TELEMETRY                          │                           │
│  │    └─ ScanHistoryDB.record()                  │                           │
│  │    └─ UsageTracker.record()                   │                           │
│  │    └─ TelemetryManager.send()                 │                           │
│  │    └─ Achievements + Streaks                  │                           │
│  └────────────────────────────────────────────────┘                           │
│                             ↓                                                  │
│  ┌────────────────────────────────────────────────┐                           │
│  │ 9. RETURN ScanPipelineResult                  │                           │
│  │    ├─ scan_result (merged detections)         │                           │
│  │    ├─ policy_decision (ALLOW/WARN/BLOCK)      │                           │
│  │    ├─ should_block (boolean)                  │                           │
│  │    ├─ duration_ms (latency)                   │                           │
│  │    └─ metadata (context)                      │                           │
│  └────────────────────────────────────────────────┘                           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                       DOMAIN LAYER (Pure Logic, NO I/O)                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐             │
│  │ RuleExecutor     │  │  PatternMatcher  │  │  Detection       │             │
│  │                  │  │                  │  │  ScanResult      │             │
│  │ - execute()      │  │ - match()        │  │  Rule            │             │
│  │ - Stateless      │  │ - Regex matching │  │  Pattern         │             │
│  │ - No I/O         │  │ - Timeout-safe   │  │  Severity (Enum) │             │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘             │
│                                                                                 │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐             │
│  │ ScanPolicy       │  │  L2Detector      │  │  ThreatType      │             │
│  │                  │  │  (Protocol)      │  │                  │             │
│  │ - should_block() │  │                  │  │  BlockAction     │             │
│  │ - Immutable      │  │ - detect()       │  │  (Enum)          │             │
│  │ - Policy logic   │  │ - ML inference   │  │  RuleFamily      │             │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘             │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                   INFRASTRUCTURE LAYER (I/O & External APIs)                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────┐                                                      │
│  │ PackRegistry        │                                                      │
│  │ ├─ Load core packs  │                                                      │
│  │ ├─ Load custom packs│                                                      │
│  │ └─ get_all_rules()  │                                                      │
│  └─────────────────────┘                                                      │
│                                                                                 │
│  ┌─────────────────────┐     ┌──────────────────┐     ┌──────────────────┐   │
│  │ ScanConfig          │     │ ScanHistoryDB    │     │ TelemetryManager │   │
│  │ ├─ from_file()      │     │ ├─ record_scan()│     │ ├─ send_event()  │   │
│  │ ├─ from_env()       │     │ └─ SQLite        │     │ ├─ Queue-based   │   │
│  │ └─ YAML/TOML        │     │ └─ Privacy hashes│     │ └─ Async sending │   │
│  └─────────────────────┘     └──────────────────┘     └──────────────────┘   │
│                                                                                 │
│  ┌─────────────────────┐     ┌──────────────────┐     ┌──────────────────┐   │
│  │ Cloud Integration   │     │ Telemetry Config │     │ Security Layer   │   │
│  │ ├─ API Clients      │     │ ├─ Batching      │     │ ├─ Auth          │   │
│  │ └─ Policy Sync      │     │ └─ Async Mode    │     │ └─ Signatures    │   │
│  └─────────────────────┘     └──────────────────┘     └──────────────────┘   │
│                                                                                 │
│  ~/.raxe/                    ~/.raxe/logs/             System Resources        │
│  ├─ config.yaml              └─ raxe.log (JSON)        ├─ Database (SQLite)   │
│  ├─ scan_history.db          └─ Rotating logs          └─ File system         │
│  └─ packs/                                                                    │
│     ├─ core/                                                                  │
│     ├─ custom/                                                                │
│     └─ community/                                                             │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                        PLUGIN SYSTEM (Extensibility)                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────────────────────────────────────────────────────┐         │
│  │                    PluginManager                                  │         │
│  │  ├─ initialize(plugins, configs)                                 │         │
│  │  ├─ execute_hook(hook_name)                                      │         │
│  │  ├─ run_detectors()  [L1 plugin layer]                           │         │
│  │  ├─ run_actions()    [Post-scan actions]                         │         │
│  │  └─ Error isolation + timeout enforcement                        │         │
│  └──────────────────────────────────────────────────────────────────┘         │
│                                                                                 │
│  Plugin Types:                                                                 │
│  ├─ RaxePlugin (Base)                                                         │
│  │  └─ Hooks: on_init, on_scan_start, on_scan_complete,                       │
│  │            on_threat_detected, on_shutdown                                  │
│  │                                                                              │
│  ├─ DetectorPlugin → detect()                                                 │
│  │  └─ Custom threat detection logic                                          │
│  │                                                                              │
│  ├─ ActionPlugin → should_execute() + execute()                               │
│  │  └─ Send Slack, log, webhook, etc.                                         │
│  │                                                                              │
│  └─ TransformPlugin → transform_input() + transform_output()                  │
│     └─ Text normalization, result enrichment                                  │
│                                                                                 │
│  Example Plugins:                                                              │
│  ├─ custom_detector (regex patterns from config)                              │
│  ├─ slack_notifier (send alerts to Slack)                                     │
│  ├─ file_logger (log detections to file)                                      │
│  └─ webhook (post results to webhook)                                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                         UTILITIES & MONITORING                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  Logging System (src/raxe/utils/logging.py):                                   │
│  ├─ Structured logging (structlog)                                             │
│  ├─ PII redaction processor (auto-redact secrets)                              │
│  ├─ Console handler (colored, human-readable)                                 │
│  └─ File handler (JSON, rotated 10MB, keep 5)                                 │
│                                                                                 │
│  Monitoring (src/raxe/monitoring/):                                            │
│  ├─ Prometheus metrics                                                         │
│  ├─ Performance profiling                                                      │
│  └─ Metrics HTTP server                                                        │
│                                                                                 │
│  Analytics (src/raxe/application/analytics/):                                  │
│  ├─ Achievement system (gamification)                                          │
│  ├─ Streak tracking                                                            │
│  ├─ Retention analytics                                                        │
│  └─ Statistics aggregation                                                     │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

╔════════════════════════════════════════════════════════════════════════════════╗
║                         KEY DESIGN PRINCIPLES                                  ║
╠════════════════════════════════════════════════════════════════════════════════╣
║                                                                                ║
║  1. SINGLE ENTRY POINT                                                         ║
║     All interfaces (CLI, SDK, decorator, wrappers) → Raxe.scan()              ║
║                                                                                ║
║  2. CLEAN ARCHITECTURE (Domain → Application → Infrastructure)                 ║
║     ├─ Domain: Pure logic, no I/O, immutable value objects                    ║
║     ├─ Application: Orchestration, use cases                                  ║
║     └─ Infrastructure: I/O, external APIs, persistence                        ║
║                                                                                ║
║  3. PLUGIN ARCHITECTURE                                                        ║
║     Plugins integrate via lifecycle hooks with error isolation                ║
║                                                                                ║
║  4. PERFORMANCE OPTIMIZATION                                                   ║
║     ├─ Preload at startup (100-200ms one-time)                               ║
║     ├─ Fail-fast on CRITICAL (skip L2)                                       ║
║     ├─ Lazy L2 loading                                                        ║
║     └─ Layer control (fast <3ms, balanced <10ms, thorough <100ms)            ║
║                                                                                ║
║  5. PRIVACY-FIRST                                                              ║
║     ├─ No prompts in database (only SHA256 hashes)                            ║
║     ├─ PII redaction in logs                                                  ║
║     ├─ No secrets in telemetry                                                ║
║     └─ Privacy-preserving analytics                                           ║
║                                                                                ║
║  6. CONFIGURATION CASCADE                                                      ║
║     Explicit parameters > Environment > Config file > Defaults                ║
║                                                                                ║
╚════════════════════════════════════════════════════════════════════════════════╝
