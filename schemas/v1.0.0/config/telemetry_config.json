{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raxe.ai/schemas/v1.0.0/config/telemetry_config.json",
  "title": "RAXE Telemetry Configuration",
  "description": "Privacy-preserving telemetry settings for event collection",
  "type": "object",
  "required": ["enabled", "privacy_mode"],
  "properties": {
    "enabled": {
      "type": "boolean",
      "default": true,
      "description": "Enable telemetry collection and transmission"
    },
    "endpoint": {
      "type": "string",
      "format": "uri",
      "default": "https://telemetry.raxe.ai/v1/events",
      "description": "Telemetry ingestion endpoint"
    },
    "privacy_mode": {
      "type": "string",
      "enum": ["strict", "standard", "detailed"],
      "default": "strict",
      "description": "Privacy level for data collection"
    },
    "include_full_prompts": {
      "type": "boolean",
      "default": false,
      "description": "Include full prompts in telemetry (opt-in only, NOT recommended)"
    },
    "include_context": {
      "type": "boolean",
      "default": true,
      "description": "Include context metadata (session_id, user_id hashes, etc.)"
    },
    "batch_size": {
      "type": "integer",
      "minimum": 1,
      "maximum": 1000,
      "default": 100,
      "description": "Number of events to batch before sending"
    },
    "flush_interval_ms": {
      "type": "integer",
      "minimum": 100,
      "maximum": 300000,
      "default": 5000,
      "description": "Maximum time to wait before flushing batch (milliseconds)"
    },
    "max_queue_size": {
      "type": "integer",
      "minimum": 10,
      "maximum": 100000,
      "default": 10000,
      "description": "Maximum events to queue before dropping oldest"
    },
    "retry_policy": {
      "$ref": "#/definitions/retry_policy"
    },
    "compression": {
      "type": "string",
      "enum": ["none", "gzip", "zstd"],
      "default": "gzip",
      "description": "Compression algorithm for telemetry payload"
    },
    "pii_redaction_rules": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "pattern": {
            "type": "string",
            "description": "Regex pattern to detect PII"
          },
          "replacement": {
            "type": "string",
            "default": "[REDACTED]",
            "description": "Replacement string for matched PII"
          }
        }
      },
      "description": "Custom PII redaction patterns"
    },
    "hash_algorithm": {
      "type": "string",
      "enum": ["sha256", "sha512", "blake2b"],
      "default": "sha256",
      "description": "Hash algorithm for privacy-preserving identifiers"
    },
    "send_performance_metrics": {
      "type": "boolean",
      "default": true,
      "description": "Include performance timing metrics"
    },
    "send_error_reports": {
      "type": "boolean",
      "default": true,
      "description": "Send error and exception telemetry"
    },
    "sample_rate": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 1.0,
      "description": "Fraction of events to send (1.0 = all, 0.1 = 10%)"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "Custom telemetry metadata attached to all events"
    }
  },
  "definitions": {
    "retry_policy": {
      "type": "object",
      "properties": {
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 3,
          "description": "Maximum number of retry attempts"
        },
        "initial_delay_ms": {
          "type": "integer",
          "minimum": 100,
          "maximum": 10000,
          "default": 1000,
          "description": "Initial retry delay (milliseconds)"
        },
        "max_delay_ms": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 60000,
          "default": 30000,
          "description": "Maximum retry delay (milliseconds)"
        },
        "backoff_multiplier": {
          "type": "number",
          "minimum": 1.0,
          "maximum": 5.0,
          "default": 2.0,
          "description": "Exponential backoff multiplier"
        },
        "retry_on_status": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 100,
            "maximum": 599
          },
          "default": [429, 500, 502, 503, 504],
          "description": "HTTP status codes that trigger retry"
        }
      }
    }
  },
  "examples": [
    {
      "enabled": true,
      "endpoint": "https://telemetry.raxe.ai/v1/events",
      "privacy_mode": "strict",
      "include_full_prompts": false,
      "include_context": true,
      "batch_size": 50,
      "flush_interval_ms": 3000,
      "max_queue_size": 5000,
      "compression": "gzip",
      "hash_algorithm": "sha256",
      "send_performance_metrics": true,
      "send_error_reports": true,
      "sample_rate": 1.0,
      "retry_policy": {
        "max_retries": 3,
        "initial_delay_ms": 1000,
        "max_delay_ms": 30000,
        "backoff_multiplier": 2.0,
        "retry_on_status": [429, 500, 502, 503, 504]
      }
    }
  ]
}
